# requirements.md

## 1. Общая информация  
**Компания:** ООО «СЛТ» (Современные литейные технологии)  
**Основана:** 22 октября 2012 года, Москва  

**Основная деятельность:**  
- Инжиниринг и проектирование литейных и металлообрабатывающих предприятий;  
- Управление строительными проектами, технический надзор, авторский контроль;  
- Поставка литейного и механообрабатывающего оборудования;  
- Разработка и внедрение технологических процессов и оснастки;  
- Сопровождение полного цикла — от аудита до запуска производства у заказчика.  

**Цель проекта:** разработать настольное приложение на базе ИИ для автоматической обработки прайс-листов и технических заданий (TXT, DOCX, PDF, XLS/XLSX, JPEG/JPG/PNG) и приведения их к единому табличному виду с функциями:  
- нормализация наименований (множественное → единственное число);  
- поиск и объединение дублей;  
- экспорт в Excel по корпоративному шаблону.  

---

## 2. Входные и выходные данные  

### Вход:  
- Один или несколько файлов форматов: TXT, DOCX, PDF, XLS/XLSX, JPEG/JPG/PNG.  
- Файлы загружаются:  
  - через кнопку «Добавить файл» (с выбором папки);  
  - методом drag-and-drop.  

### Выход:  
- Таблица Excel в корпоративном стиле.  
- Варианты:  
  - **Умное распределение**: автоматическая разметка по колонкам:  
    *Обозначение, Наименование, Производитель, Единица измерения, Количество, Техническое задание*.  
  - **Упрощённое распределение**: минимальная разметка по колонкам:  
    *Наименование, Единица измерения, Количество, Техническое задание*.  

---

## 3. Ключевые сценарии  

| Шаг | Действие пользователя | Результат |
|-----|-----------------------|-----------|
| 1 | Загружает файл(ы) | Срабатывает drag-and-drop или кнопка выбора |
| 2 | Выбирает режим (умное / упрощённое) | Парсер формирует `pandas.DataFrame` |
| 3 | Проверяет выделенные ячейки: <br>– жёлтые (мн. → ед. число) <br>– красные (дубли) | Используются `pymorphy2` и `RapidFuzz`; пользователю предлагается подтвердить/отклонить изменения |
| 4 | Подтверждает обработку | Итоговые данные объединяются в таблицу |
| 5 | Нажимает «Экспорт» | Создаётся Excel-файл (`openpyxl`, `xlsxwriter`), стилизованный по корпоративному шаблону |

---

## 4. Технологический стек  

- **Парсинг:**  
  - `python-docx` — DOCX;  
  - `pdfplumber` — PDF;  
  - `pandas` — контейнер данных, обработка дублей.  

- **Нормализация и поиск дублей:**  
  - `pymorphy2` — морфология (мн. → ед. число);  
  - `RapidFuzz` — поиск похожих строк (≥ 90 %).  

- **Экспорт:**  
  - `openpyxl` — создание/редактирование Excel;  
  - `xlsxwriter` — стилизация и форматирование.  

- **GUI:**  
  - `Streamlit` (вариант — PyQt5).  

---

## 5. Архитектура  

```
┌─ UI (Streamlit / PyQt) ─┐
│                         ▼
│   FileLoader ───────────┐
│   (определение типа)    │
└─────────────────────────┘
        ▼                 ▼
 TXTParser   DocxParser   PDFParser
        ▼                 ▼
          DataFrame  ←  «Сырые» строки
               │
           Normalizer
               │
        DuplicateResolver
               │
          FieldMapper
               │
           ExcelWriter
```

- **FieldMapper** — реализует «умное»/«упрощённое» распределение колонок.  
- Каждая стадия: ведёт лог, поддерживает Undo.  

---

## 6. Дополнительные требования  

- В случае неоднозначных данных (например, «Код заказа» в PDF) приложение должно:  
  - предложить пользователю выбрать колонку;  
  - либо распределить автоматически с возможностью ручной корректировки.  

- При нормализации слов (мн. → ед. число) — спрашивать пользователя, если замена неочевидна.  
  - Пример: *«сверлильные патроны» → «сверлильный патрон»*.  

- При поиске дублей — суммировать количество, если пользователь подтверждает объединение.  
- Ведение логов обработки для обучения сотрудников.  

---

## 7. Критерии приёмки  

1. Приложение корректно открывает все заявленные форматы файлов.  
2. Дубли находятся и корректно объединяются с сохранением числовых данных.  
3. Нормализация выполняется с контролем пользователя.  
4. Итоговый Excel соответствует корпоративному шаблону.  
5. Интерфейс поддерживает оба варианта загрузки файлов (кнопка / drag-and-drop).  
6. Все ключевые действия логируются и поддерживают Undo.  
